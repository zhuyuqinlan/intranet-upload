/*
 * SparkMD5 v3.0.2
 */
(function(factory){
    if(typeof exports==='object'){
        module.exports=factory();
    }else if(typeof define==='function'&&define.amd){
        define(factory);
    }else{
        var glob;
        try{
            glob=window;
        }catch(_){
            glob=self;
        }
        glob.SparkMD5=factory();
    }
}(function(undefined){
    'use strict';

    var add32=function(a,b){return(a+b)&0xFFFFFFFF},hexChars='0123456789abcdef',extra=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

    function md5cycle(x,k){
        var a=x[0],b=x[1],c=x[2],d=x[3];
        a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);
        a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);
        a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);
        a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);
        a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);
        a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);
        a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);
        a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);
        a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);
        a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);
        a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);
        a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);
        a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);
        a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);
        a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);
        a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);
        x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3]);
    }

    function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32((a<<s)|(a>>>(32-s)),b)}
    function ff(a,b,c,d,x,s,t){return cmn((b&c)|((~b)&d),a,b,x,s,t)}
    function gg(a,b,c,d,x,s,t){return cmn((b&d)|(c&(~d)),a,b,x,s,t)}
    function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)}
    function ii(a,b,c,d,x,s,t){return cmn(c^(b|(~d)),a,b,x,s,t)}
    function md51(s){var n=s.length,state=[1732584193,-271733879,-1732584194,271733878],i;
        for(i=64;i<=s.length;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)))}
        s=s.substring(i-64);
        var tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        for(i=0;i<s.length;i++)tail[i>>2]|=s.charCodeAt(i)<<((i%4)<<3);
        tail[i>>2]|=0x80<<((i%4)<<3);
        if(i>55){md5cycle(state,tail);for(i=0;i<16;i++)tail[i]=0}
        tail[14]=n*8;md5cycle(state,tail);return state}
    function md5blk(s){var md5blks=[],i;
        for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)|(s.charCodeAt(i+1)<<8)|(s.charCodeAt(i+2)<<16)|(s.charCodeAt(i+3)<<24)}
        return md5blks}

    function core_md5(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;
        var a=1732584193,b=-271733879,c=-1732584194,d=271733878,i;
        for(i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d;
            a=ff(a,b,c,d,x[i+0],7,-680876936);d=ff(d,a,b,c,x[i+1],12,-389564586);c=ff(c,d,a,b,x[i+2],17,606105819);b=ff(b,c,d,a,x[i+3],22,-1044525330);
            a=ff(a,b,c,d,x[i+4],7,-176418897);d=ff(d,a,b,c,x[i+5],12,1200080426);c=ff(c,d,a,b,x[i+6],17,-1473231341);b=ff(b,c,d,a,x[i+7],22,-45705983);
            a=ff(a,b,c,d,x[i+8],7,1770035416);d=ff(d,a,b,c,x[i+9],12,-1958414417);c=ff(c,d,a,b,x[i+10],17,-42063);b=ff(b,c,d,a,x[i+11],22,-1990404162);
            a=ff(a,b,c,d,x[i+12],7,1804603682);d=ff(d,a,b,c,x[i+13],12,-40341101);c=ff(c,d,a,b,x[i+14],17,-1502002290);b=ff(b,c,d,a,x[i+15],22,1236535329);
            a=gg(a,b,c,d,x[i+1],5,-165796510);d=gg(d,a,b,c,x[i+6],9,-1069501632);c=gg(c,d,a,b,x[i+11],14,643717713);b=gg(b,c,d,a,x[i+0],20,-373897302);
            a=gg(a,b,c,d,x[i+5],5,-701558691);d=gg(d,a,b,c,x[i+10],9,38016083);c=gg(c,d,a,b,x[i+15],14,-660478335);b=gg(b,c,d,a,x[i+4],20,-405537848);
            a=gg(a,b,c,d,x[i+9],5,568446438);d=gg(d,a,b,c,x[i+14],9,-1019803690);c=gg(c,d,a,b,x[i+3],14,-187363961);b=gg(b,c,d,a,x[i+8],20,1163531501);
            a=gg(a,b,c,d,x[i+13],5,-1444681467);d=gg(d,a,b,c,x[i+2],9,-51403784);c=gg(c,d,a,b,x[i+7],14,1735328473);b=gg(b,c,d,a,x[i+12],20,-1926607734);
            a=hh(a,b,c,d,x[i+5],4,-378558);d=hh(d,a,b,c,x[i+8],11,-2022574463);c=hh(c,d,a,b,x[i+11],16,1839030562);b=hh(b,c,d,a,x[i+14],23,-35309556);
            a=hh(a,b,c,d,x[i+1],4,-1530992060);d=hh(d,a,b,c,x[i+4],11,1272893353);c=hh(c,d,a,b,x[i+7],16,-155497632);b=hh(b,c,d,a,x[i+10],23,-1094730640);
            a=hh(a,b,c,d,x[i+13],4,681279174);d=hh(d,a,b,c,x[i+0],11,-358537222);c=hh(c,d,a,b,x[i+3],16,-722521979);b=hh(b,c,d,a,x[i+6],23,76029189);
            a=hh(a,b,c,d,x[i+9],4,-640364487);d=hh(d,a,b,c,x[i+12],11,-421815835);c=hh(c,d,a,b,x[i+15],16,530742520);b=hh(b,c,d,a,x[i+2],23,-995338651);
            a=ii(a,b,c,d,x[i+0],6,-198630844);d=ii(d,a,b,c,x[i+7],10,1126891415);c=ii(c,d,a,b,x[i+14],15,-1416354905);b=ii(b,c,d,a,x[i+5],21,-57434055);
            a=ii(a,b,c,d,x[i+12],6,1700485571);d=ii(d,a,b,c,x[i+3],10,-1894986606);c=ii(c,d,a,b,x[i+10],15,-1051523);b=ii(b,c,d,a,x[i+1],21,-2054922799);
            a=ii(a,b,c,d,x[i+8],6,1873313359);d=ii(d,a,b,c,x[i+15],10,-30611744);c=ii(c,d,a,b,x[i+6],15,-1560198380);b=ii(b,c,d,a,x[i+13],21,1309151649);
            a=ii(a,b,c,d,x[i+4],6,-145523070);d=ii(d,a,b,c,x[i+11],10,-1120210379);c=ii(c,d,a,b,x[i+2],15,718787259);b=ii(b,c,d,a,x[i+9],21,-343485551);
            a=add32(a,olda);b=add32(b,oldb);c=add32(c,oldc);d=add32(d,oldd);
        }
        return [a,b,c,d];
    }

    function binl2rstr(input){var i,output='';
        for(i=0;i<input.length*32;i+=8){output+=String.fromCharCode((input[i>>5]>>>(i%32))&0xFF)}
        return output}
    function rstr2binl(input){var i,output=[];
        output[(input.length>>2)-1]=undefined;
        for(i=0;i<output.length;i++){output[i]=0}
        for(i=0;i<input.length*8;i+=8){output[i>>5]|=(input.charCodeAt(i/8)&0xFF)<<(i%32)}
        return output}
    function rstr2hex(input){var hex_tab=hexChars,output='',i;
        for(i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt((x>>>4)&0x0F)+hex_tab.charAt(x&0x0F)}
        return output}
    function str2rstr_utf8(input){var output='',i=-1,x,y;
        while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;
            if(0xD800<=x&&x<=0xDBFF&&0xDC00<=y&&y<=0xDFFF){x=0x10000+((x&0x03FF)<<10)+(y&0x03FF);i++}
            if(x<=0x7F){output+=String.fromCharCode(x)}else if(x<=0x7FF){output+=String.fromCharCode(0xC0|((x>>>6)&0x1F),0x80|(x&0x3F))}else if(x<=0xFFFF){output+=String.fromCharCode(0xE0|((x>>>12)&0x0F),0x80|((x>>>6)&0x3F),0x80|(x&0x3F))}else if(x<=0x1FFFFF){output+=String.fromCharCode(0xF0|((x>>>18)&0x07),0x80|((x>>>12)&0x3F),0x80|((x>>>6)&0x3F),0x80|(x&0x3F))}
        }
        return output}

    function rstr_md5(s){return binl2rstr(core_md5(rstr2binl(s),s.length*8))}
    function rstr_hmac_md5(key,data){var bkey=rstr2binl(key),ipad,opad,i,hash;
        if(bkey.length>16){bkey=core_md5(bkey,key.length*8)}
        ipad=[];opad=[];
        for(i=0;i<16;i++){ipad[i]=bkey[i]^0x36363636;opad[i]=bkey[i]^0x5C5C5C5C}
        hash=core_md5(ipad.concat(rstr2binl(data)),512+data.length*8);
        return core_md5(opad.concat(hash),768)}

    function hex_md5(s){return rstr2hex(rstr_md5(s))}
    function b64_md5(s){return rstr2b64(rstr_md5(s))}
    function any_md5(s,e){return rstr2any(rstr_md5(s),e)}
    function hex_hmac_md5(k,d){return rstr2hex(rstr_hmac_md5(k,d))}
    function b64_hmac_md5(k,d){return rstr2b64(rstr_hmac_md5(k,d))}
    function any_hmac_md5(k,d,e){return rstr2any(rstr_hmac_md5(k,d),e)}

    function md5(string,key,raw){if(!key){if(!raw){return hex_md5(string)}else{return rstr_md5(string)}}if(!raw){return hex_hmac_md5(key,string)}else{return rstr_hmac_md5(key,string)}}

    function SparkMD5(){this.reset()}
    SparkMD5.prototype.append=function(str){this.appendBinary(str2rstr_utf8(str));return this};
    SparkMD5.prototype.appendBinary=function(content){this._buff+=content;this._length+=content.length;
        var start=this._buff.length;
        if(start>=64){
            var offset=0;
            do{this._hash=md5cycle(this._hash,md5blk(this._buff));offset+=64}while((start-64)>=64)
            this._buff=this._buff.substring(offset);
        }
        return this
    };
    SparkMD5.prototype.end=function(raw){var buff=this._buff,length=buff.length,i,tmp=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        for(i=0;i<length;i++){tmp[i>>2]|=buff.charCodeAt(i)<<((i%4)<<3)}
        tmp[i>>2]|=0x80<<((i%4)<<3);if(i>55){md5cycle(this._hash,tmp);i=0}
        tmp[14]=this._length*8;md5cycle(this._hash,tmp);
        if(raw){return binl2rstr(this._hash)}else{return rstr2hex(this._hash)}
    };
    SparkMD5.prototype.reset=function(){this._buff='';this._length=0;this._hash=[1732584193,-271733879,-1732584194,271733878];return this};
    SparkMD5.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}};
    SparkMD5.prototype.setState=function(state){this._buff=state.buff;this._length=state.length;this._hash=state.hash;return this};
    SparkMD5.prototype.destroy=function(){delete this._hash;delete this._buff;delete this._length};

    SparkMD5.hash=function(str,raw){return SparkMD5.prototype.hash(str,raw)};
    SparkMD5.hashBinary=function(content,raw){return SparkMD5.prototype.hashBinary(content,raw)};
    SparkMD5.ArrayBuffer=function(){this.reset()};
    SparkMD5.ArrayBuffer.prototype.append=function(arr){
        var buff= new Uint8Array(arr),length=buff.length,i;
        this._length+=length;
        for(i=0;i<length;i++){this._buff[this._pos++] = buff[i];if(this._pos===64){
            this._hash=md5cycle(this._hash,this._buff);this._pos=0
        }}
    };
    SparkMD5.ArrayBuffer.prototype.end=function(raw){
        var length=this._length%64,pos=this._pos,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        this._buff[this._pos]=0x80;
        if(this._pos>55){
            while(pos<64){this._buff[pos++]=0}
            md5cycle(this._hash,this._buff);pos=0
        }
        while(pos<59){this._buff[pos++]=0}
        this._buff[14]=(this._length*8)/Math.pow(2,32);
        this._buff[15]=(this._length*8)&0xffffffff;
        md5cycle(this._hash,this._buff);
        if(raw){return binl2rstr(this._hash)}else{return rstr2hex(this._hash)}
    };
    SparkMD5.ArrayBuffer.prototype.reset=function(){this._buff=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this._pos=0;this._length=0;this._hash=[1732584193,-271733879,-1732584194,271733878]};
    SparkMD5.ArrayBuffer.hash=function(arr,raw){return(new SparkMD5.ArrayBuffer()).append(arr).end(raw)};
    return SparkMD5;
}));